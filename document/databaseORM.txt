Ù…Ù…ØªØ§Ø²! Ø¯Ø¹Ù†Ø§ Ù†Ø³ØªÙ…Ø± ÙÙŠ ØªÙØµÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„.

## ğŸ—ƒï¸ **Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙØµÙ„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**

### **1. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (User)**
```python
class User(AbstractUser):
    USER_ROLES = (
        ('user', 'Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ'),
        ('admin', 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…'),
    )
    
    role = models.CharField(max_length=10, choices=USER_ROLES, default='user')
    phone = models.CharField(max_length=15, blank=True, null=True)
    date_of_birth = models.DateField(blank=True, null=True)
    nationality = models.CharField(max_length=50, blank=True, null=True)
    passport_number = models.CharField(max_length=20, blank=True, null=True)
    preferences = models.JSONField(default=dict, blank=True)  # ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø³ÙØ±
    is_verified = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'users'
        verbose_name = 'Ù…Ø³ØªØ®Ø¯Ù…'
        verbose_name_plural = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†'
```

### **2. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙˆØ¬Ù‡Ø© (Destination)**
```python
class Destination(models.Model):
    DESTINATION_TYPES = (
        ('city', 'Ù…Ø¯ÙŠÙ†Ø©'),
        ('historical', 'Ù…ÙˆÙ‚Ø¹ ØªØ§Ø±ÙŠØ®ÙŠ'),
        ('natural', 'Ù…ÙˆÙ‚Ø¹ Ø·Ø¨ÙŠØ¹ÙŠ'),
        ('coastal', 'Ø³Ø§Ø­Ù„ÙŠ'),
    )
    
    name = models.CharField(max_length=100)
    type = models.CharField(max_length=20, choices=DESTINATION_TYPES)
    description = models.TextField()
    governorate = models.CharField(max_length=50)  # Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
    latitude = models.FloatField()
    longitude = models.FloatField()
    popularity_score = models.IntegerField(default=0)
    best_season = models.CharField(max_length=100)  # Ø§Ù„Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
    image_url = models.URLField(blank=True, null=True)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        db_table = 'destinations'
        indexes = [
            models.Index(fields=['governorate', 'type']),
            models.Index(fields=['popularity_score']),
        ]
```

### **3. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø© (Service)**
```python
class Service(models.Model):
    SERVICE_TYPES = (
        ('hotel', 'ÙÙ†Ø¯Ù‚'),
        ('transport', 'Ù…ÙˆØ§ØµÙ„Ø§Øª'),
        ('restaurant', 'Ù…Ø·Ø¹Ù…'),
        ('activity', 'Ù†Ø´Ø§Ø· ØªØ±ÙÙŠÙ‡ÙŠ'),
        ('guide', 'Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ'),
    )
    
    SERVICE_LEVELS = (
        ('economy', 'Ø§Ù‚ØªØµØ§Ø¯ÙŠ'),
        ('standard', 'Ù‚ÙŠØ§Ø³ÙŠ'),
        ('premium', 'Ù…ØªÙ…ÙŠØ²'),
        ('luxury', 'ÙØ§Ø®Ø±'),
    )
    
    name = models.CharField(max_length=200)
    type = models.CharField(max_length=20, choices=SERVICE_TYPES)
    level = models.CharField(max_length=15, choices=SERVICE_LEVELS, default='standard')
    description = models.TextField()
    destination = models.ForeignKey(Destination, on_delete=models.CASCADE, related_name='services')
    address = models.TextField()
    contact_phone = models.CharField(max_length=15, blank=True, null=True)
    contact_email = models.EmailField(blank=True, null=True)
    price_per_unit = models.DecimalField(max_digits=10, decimal_places=2)
    unit_description = models.CharField(max_length=100)  # "Ù„ÙŠÙ„Ø©", "Ø±Ø­Ù„Ø©", "ÙˆØ¬Ø¨Ø©"
    capacity = models.IntegerField(blank=True, null=True)  # Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ÙŠØ©
    features = models.JSONField(default=list)  # Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª ["ÙˆØ§ÙŠ ÙØ§ÙŠ", "Ù…Ø³Ø¨Ø­", ...]
    rating = models.FloatField(default=0.0)
    image_urls = models.JSONField(default=list)  # Ù‚Ø§Ø¦Ù…Ø© ØµÙˆØ± Ø§Ù„Ø®Ø¯Ù…Ø©
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'services'
        indexes = [
            models.Index(fields=['type', 'level']),
            models.Index(fields=['destination', 'type']),
        ]
```

### **4. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø§Ù‚Ø© (Package)**
```python
class Package(models.Model):
    PACKAGE_TYPES = (
        ('family', 'Ø¹Ø§Ø¦Ù„ÙŠØ©'),
        ('adventure', 'Ù…ØºØ§Ù…Ø±Ø©'),
        ('cultural', 'Ø«Ù‚Ø§ÙÙŠØ©'),
        ('honeymoon', 'Ø´Ù‡Ø± Ø¹Ø³Ù„'),
        ('religious', 'Ø¯ÙŠÙ†ÙŠØ©'),
    )
    
    title = models.CharField(max_length=200)
    type = models.CharField(max_length=20, choices=PACKAGE_TYPES)
    description = models.TextField()
    short_description = models.CharField(max_length=300)
    duration_days = models.PositiveIntegerField()
    base_price = models.DecimalField(max_digits=10, decimal_places=2)
    discount_price = models.DecimalField(max_digits=10, decimal_places=2, blank=True, null=True)
    destinations = models.ManyToManyField(Destination, through='PackageDestination')
    services = models.ManyToManyField(Service, through='PackageService')
    included_services = models.JSONField(default=list)  # Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø©
    excluded_services = models.JSONField(default=list)  # Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø©
    daily_schedule = models.JSONField()  # {Ø§Ù„ÙŠÙˆÙ…1: {ØµØ¨Ø§Ø­: Ù†Ø´Ø§Ø·, Ø¸Ù‡Ø±: Ù†Ø´Ø§Ø·, Ù…Ø³Ø§Ø¡: Ù†Ø´Ø§Ø·}}
    terms_conditions = models.TextField()
    cancellation_policy = models.TextField()
    image_urls = models.JSONField(default=list)
    popularity_count = models.IntegerField(default=0)
    is_featured = models.BooleanField(default=False)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'packages'
        indexes = [
            models.Index(fields=['type', 'is_active']),
            models.Index(fields=['base_price']),
        ]
```

### **5. Ù†Ù…ÙˆØ°Ø¬ ÙˆØ³ÙŠØ· Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ§Ù„ÙˆØ¬Ù‡Ø© (PackageDestination)**
```python
class PackageDestination(models.Model):
    package = models.ForeignKey(Package, on_delete=models.CASCADE)
    destination = models.ForeignKey(Destination, on_delete=models.CASCADE)
    visit_order = models.PositiveIntegerField()  # ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²ÙŠØ§Ø±Ø©
    duration_hours = models.PositiveIntegerField()  # Ù…Ø¯Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡
    description = models.TextField(blank=True, null=True)  # ÙˆØµÙ Ø§Ù„Ø²ÙŠØ§Ø±Ø©

    class Meta:
        db_table = 'package_destinations'
        unique_together = ['package', 'destination']
        ordering = ['visit_order']
```

### **6. Ù†Ù…ÙˆØ°Ø¬ ÙˆØ³ÙŠØ· Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø© (PackageService)**
```python
class PackageService(models.Model):
    TIME_SLOTS = (
        ('morning', 'ØµØ¨Ø§Ø­'),
        ('afternoon', 'Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±'),
        ('evening', 'Ù…Ø³Ø§Ø¡'),
    )
    
    package = models.ForeignKey(Package, on_delete=models.CASCADE)
    service = models.ForeignKey(Service, on_delete=models.CASCADE)
    day_number = models.PositiveIntegerField()  # Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø±Ø­Ù„Ø©
    time_slot = models.CharField(max_length=10, choices=TIME_SLOTS)
    quantity = models.PositiveIntegerField(default=1)
    notes = models.TextField(blank=True, null=True)

    class Meta:
        db_table = 'package_services'
        ordering = ['day_number', 'time_slot']
```

### **7. Ù†Ù…ÙˆØ°Ø¬ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (ChatSession)**
```python
class ChatSession(models.Model):
    SESSION_STATUS = (
        ('active', 'Ù†Ø´Ø·Ø©'),
        ('plan_generated', 'ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©'),
        ('price_quoted', 'ØªÙ… Ø§Ù„ØªØ³Ø¹ÙŠØ±'),
        ('completed', 'Ù…ÙƒØªÙ…Ù„Ø©'),
        ('cancelled', 'Ù…Ù„ØºØ§Ø©'),
    )
    
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='chat_sessions')
    session_id = models.CharField(max_length=100, unique=True)
    initial_requirements = models.JSONField(default=dict)  # Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    conversation_history = models.JSONField(default=list)  # Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    extracted_preferences = models.JSONField(default=dict)  # Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ù„ØµØ©
    generated_plan = models.JSONField(default=dict)  # Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©
    budget_range = models.JSONField(default=dict)  # {min: X, max: Y}
    duration_days = models.PositiveIntegerField(blank=True, null=True)
    status = models.CharField(max_length=20, choices=SESSION_STATUS, default='active')
    estimated_price = models.DecimalField(max_digits=10, decimal_places=2, blank=True, null=True)
    final_price = models.DecimalField(max_digits=10, decimal_places=2, blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    expires_at = models.DateTimeField()  # Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©

    class Meta:
        db_table = 'chat_sessions'
        indexes = [
            models.Index(fields=['user', 'status']),
            models.Index(fields=['expires_at']),
        ]
```

### **8. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø®ØµØµØ© (CustomTrip)**
```python
class CustomTrip(models.Model):
    TRIP_STATUS = (
        ('draft', 'Ù…Ø³ÙˆØ¯Ø©'),
        ('quoted', 'Ù…Ø³Ø¹Ø±'),
        ('confirmed', 'Ù…Ø¤ÙƒØ¯'),
        ('booked', 'Ù…Ø­Ø¬ÙˆØ²'),
        ('completed', 'Ù…ÙƒØªÙ…Ù„'),
        ('cancelled', 'Ù…Ù„ØºÙ‰'),
    )
    
    chat_session = models.OneToOneField(ChatSession, on_delete=models.CASCADE)
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='custom_trips')
    title = models.CharField(max_length=200)
    destinations = models.ManyToManyField(Destination, through='CustomTripDestination')
    services = models.ManyToManyField(Service, through='CustomTripService')
    duration_days = models.PositiveIntegerField()
    total_price = models.DecimalField(max_digits=10, decimal_places=2)
    daily_plan = models.JSONField()  # Ø§Ù„Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
    included_services = models.JSONField(default=list)
    special_requests = models.TextField(blank=True, null=True)
    status = models.CharField(max_length=15, choices=TRIP_STATUS, default='draft')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'custom_trips'
```

### **9. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø² (Booking)**
```python
class Booking(models.Model):
    BOOKING_TYPES = (
        ('package', 'Ø¨Ø§Ù‚Ø© Ø¬Ø§Ù‡Ø²Ø©'),
        ('custom', 'Ø±Ø­Ù„Ø© Ù…Ø®ØµØµØ©'),
    )
    
    BOOKING_STATUS = (
        ('pending', 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'),
        ('confirmed', 'Ù…Ø¤ÙƒØ¯'),
        ('paid', 'Ù…Ø¯ÙÙˆØ¹'),
        ('active', 'Ù†Ø´Ø·'),
        ('completed', 'Ù…ÙƒØªÙ…Ù„'),
        ('cancelled', 'Ù…Ù„ØºÙ‰'),
        ('refunded', 'ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯'),
    )
    
    booking_number = models.CharField(max_length=20, unique=True)
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='bookings')
    booking_type = models.CharField(max_length=10, choices=BOOKING_TYPES)
    package = models.ForeignKey(Package, on_delete=models.CASCADE, blank=True, null=True)
    custom_trip = models.ForeignKey(CustomTrip, on_delete=models.CASCADE, blank=True, null=True)
    status = models.CharField(max_length=15, choices=BOOKING_STATUS, default='pending')
    total_price = models.DecimalField(max_digits=10, decimal_places=2)
    number_of_travelers = models.PositiveIntegerField(default=1)
    traveler_details = models.JSONField(default=list)  # ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ±ÙŠÙ†
    special_requests = models.TextField(blank=True, null=True)
    start_date = models.DateField()
    end_date = models.DateField()
    booking_date = models.DateTimeField(auto_now_add=True)
    confirmation_date = models.DateTimeField(blank=True, null=True)
    cancellation_date = models.DateTimeField(blank=True, null=True)
    cancellation_reason = models.TextField(blank=True, null=True)

    class Meta:
        db_table = 'bookings'
        indexes = [
            models.Index(fields=['user', 'status']),
            models.Index(fields=['booking_number']),
            models.Index(fields=['start_date', 'end_date']),
        ]
```

### **10. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯ÙØ¹ (Payment)**
```python
class Payment(models.Model):
    PAYMENT_STATUS = (
        ('pending', 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'),
        ('processing', 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'),
        ('completed', 'Ù…ÙƒØªÙ…Ù„'),
        ('failed', 'ÙØ§Ø´Ù„'),
        ('refunded', 'ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯'),
        ('cancelled', 'Ù…Ù„ØºÙ‰'),
    )
    
    PAYMENT_METHODS = (
        ('credit_card', 'Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†'),
        ('debit_card', 'Ø¨Ø·Ø§Ù‚Ø© Ø®ØµÙ…'),
        ('bank_transfer', 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ'),
        ('digital_wallet', 'Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©'),
    )
    
    payment_number = models.CharField(max_length=20, unique=True)
    booking = models.ForeignKey(Booking, on_delete=models.CASCADE, related_name='payments')
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    payment_method = models.CharField(max_length=20, choices=PAYMENT_METHODS)
    status = models.CharField(max_length=15, choices=PAYMENT_STATUS, default='pending')
    transaction_id = models.CharField(max_length=100, blank=True, null=True)
    payment_gateway_response = models.JSONField(blank=True, null=True)  # Ø±Ø¯ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹
    payment_date = models.DateTimeField(blank=True, null=True)
    refund_amount = models.DecimalField(max_digits=10, decimal_places=2, default=0)
    refund_date = models.DateTimeField(blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'payments'
        indexes = [
            models.Index(fields=['payment_number']),
            models.Index(fields=['booking', 'status']),
        ]
```

### **11. Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (Review)**
```python
class Review(models.Model):
    RATING_CHOICES = [
        (1, '1 Ù†Ø¬Ù…Ø©'),
        (2, '2 Ù†Ø¬Ù…ØªÙŠÙ†'),
        (3, '3 Ù†Ø¬ÙˆÙ…'),
        (4, '4 Ù†Ø¬ÙˆÙ…'),
        (5, '5 Ù†Ø¬ÙˆÙ…'),
    ]
    
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='reviews')
    package = models.ForeignKey(Package, on_delete=models.CASCADE, blank=True, null=True)
    custom_trip = models.ForeignKey(CustomTrip, on_delete=models.CASCADE, blank=True, null=True)
    rating = models.PositiveIntegerField(choices=RATING_CHOICES)
    title = models.CharField(max_length=200, blank=True, null=True)
    comment = models.TextField()
    is_verified = models.BooleanField(default=False)  # Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø­Ø¬Ø² ÙØ¹Ù„ÙŠ
    helpful_count = models.IntegerField(default=0)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        db_table = 'reviews'
        constraints = [
            models.CheckConstraint(
                check=(
                    models.Q(package__isnull=False) | 
                    models.Q(custom_trip__isnull=False)
                ),
                name='review_has_target'
            )
        ]
```

---

## ğŸ”— **Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬:**

```
User
 â”œâ”€â”€ ChatSession (One-to-Many)
 â”œâ”€â”€ CustomTrip (One-to-Many) 
 â”œâ”€â”€ Booking (One-to-Many)
 â””â”€â”€ Review (One-to-Many)

Package
 â”œâ”€â”€ PackageDestination (Many-to-Many through)
 â”œâ”€â”€ PackageService (Many-to-Many through)
 â”œâ”€â”€ Booking (One-to-Many)
 â””â”€â”€ Review (One-to-Many)

ChatSession
 â””â”€â”€ CustomTrip (One-to-One)

CustomTrip
 â”œâ”€â”€ CustomTripDestination (Many-to-Many through)
 â”œâ”€â”€ CustomTripService (Many-to-Many through)
 â”œâ”€â”€ Booking (One-to-Many)
 â””â”€â”€ Review (One-to-Many)

Booking
 â””â”€â”€ Payment (One-to-Many)
```

**Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ù† Ø£Ø¶ÙŠÙ Ø£ÙŠ Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø¶Ø§ÙÙŠØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØŸ Ø£Ù… Ù†Ù†ØªÙ‚Ù„ Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù€APIØŸ**